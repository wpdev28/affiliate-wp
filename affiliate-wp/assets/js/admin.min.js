jQuery(document).ready(function($){function maybe_activate_migrate_users_button(){var checked=$("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,$button=$("#affiliate-wp-migrate-user-accounts input[type=submit]");checked>0?$button.prop("disabled",!1):$button.prop("disabled",!0)}var file_frame;window.formfield="",$("body").on("click",".affwp_settings_upload_button",function(e){e.preventDefault();var button=$(this);return window.formfield=$(this).parent().prev(),file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:button.data("uploader_title"),button:{text:button.data("uploader_button_text")},multiple:!1}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("insert",function(){var selection=file_frame.state().get("selection");selection.each(function(attachment,index){attachment=attachment.toJSON(),window.formfield.val(attachment.url)})}),void file_frame.open())});var file_frame;window.formfield="",$(".affwp-referrals-export-toggle").click(function(){$(".affwp-referrals-export-toggle").toggle(),$("#affwp-referrals-export-form").slideToggle()}),$(".affwp-datepicker").length&&$(".affwp-datepicker").datepicker({dateFormat:"mm/dd/yy"}),$(".affwp-user-search").each(function(){var $all_input_fields,$all_fields_excluding_search,$this=$(this),$action="affwp_search_users",$search=$this.val(),$status=$this.data("affwp-status"),$form=$this.closest("form"),$submit=$form.find(":submit.button-primary"),$submit_default_value=$submit.val(),$user_creation_fields=$(".affwp-user-email-wrap, .affwp-user-pass-wrap"),$on_complete_enabled=$this.hasClass("affwp-enable-on-complete");$on_complete_enabled===!0&&($all_input_fields=$form.find("input, select"),$all_fields_excluding_search=$all_input_fields.not($this)),$this.on("input",function(){$user_creation_fields.hide()}),$this.autocomplete({source:ajaxurl+"?action="+$action+"&term="+$search+"&status="+$status,messages:{noResults:$on_complete_enabled?"":"No users found"},delay:500,minLength:2,position:{offset:"0, -1"},search:function(){$this.hasClass("affwp-enable-on-complete")&&($("div.notice").remove(),$user_creation_fields.hide())},open:function(){$this.addClass("open")},close:function(){$this.removeClass("open")},response:function(event,ui){0===ui.content.length&&$this.hasClass("affwp-enable-on-complete")?($('<div class="notice notice-error affwp-new-affiliate-error"><p>'+affwp_vars.no_user_found+"</p></div>").insertAfter($this),wp.a11y.speak(affwp_vars.no_user_found,"polite"),$form.find("input, select").prop("disabled",!1),$(".affwp-user-email-wrap, .affwp-user-pass-wrap").show(),$(".affwp-user-email").prop("required"),$(".search-description").hide(),$submit.val(affwp_vars.user_and_affiliate_input)):wp.a11y.speak(affwp_vars.valid_user_selected,"polite")},select:function(){$this.hasClass("affwp-enable-on-complete")&&$.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_check_user_login",user:$this.val()},dataType:"json",success:function(response){if(response.success)if(!1===response.data.affiliate)$form.find("input, select").prop("disabled",!1);else{var viewLink='<a href="'+response.data.url+'">'+affwp_vars.view_affiliate+"</a>";$('<div class="notice notice-info affwp-new-affiliate-error"><p>'+affwp_vars.existing_affiliate+" "+viewLink+"</p></div>").insertAfter($this),$this.prop("disabled",!1)}}}).fail(function(response){window.console&&window.console.log&&console.log(response)})}}),$on_complete_enabled===!0&&$this.on("input",function(){$all_fields_excluding_search.prop("disabled",!0),$submit.val($submit_default_value)})});var file_frame;if($("body").on("click",".upload_image_button",function(e){e.preventDefault();var formfield=$(this).prev();return file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("select",function(){var attachment=file_frame.state().get("selection").first().toJSON();formfield.val(attachment.url);var img=$("<img />");img.attr("src",attachment.url),$("#preview_image").empty().append(img),$("#preview_image img")&&$("#preview_image").show()}),void file_frame.open())}),$("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(e){return!!confirm(affwp_vars.confirm_delete_referral)}),maybe_activate_migrate_users_button(),$("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){maybe_activate_migrate_users_button()}),$("#affwp_add_affiliate #status").change(function(){var status=$(this).val();"active"==status?$("#affwp-welcome-email-row").show():($("#affwp-welcome-email-row").hide(),$("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),$("#generate-coupon-code-button").on("click",function(event){event.preventDefault(),$.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_generate_coupon_code",affiliate_id:$(this).data("affiliate_id")},dataType:"json",success:function(response){response.success&&response.data.coupon_code&&$("#coupon_code").val(response.data.coupon_code)}})}),"?page=affiliate-wp-settings&tab=coupons"===window.location.search){const getCustomText=function(){var customText=document.getElementById("affwp_settings[coupon_custom_text]").value;return""===customText?"TEXT":customText.replace(/[^0-9a-z]/gi,"")},returnLivePreviewText=function(text){var previewText=text;previewText=previewText.replace("{coupon_code}","FGFUVCQOK1"),previewText=previewText.replace("{user_name}","CREATIVELABS"),previewText=previewText.replace("{first_name}","BOB"),previewText=previewText.replace("{coupon_amount}","10"),previewText=previewText.replace("{custom_text}",getCustomText()),previewText=previewText.toUpperCase();var keepHyphens=checkHyphenDelimiterSetting();return!0===keepHyphens?previewText:previewText.replace(/-/g,"")},updateCouponFormatOptions=function(){var hyphenSettingChecked=checkHyphenDelimiterSetting(),formatOptions=document.getElementById("affwp_settings[coupon_format]").options;if(!0===hyphenSettingChecked)for(var index=0;index<formatOptions.length;index++)formatOptions[index].text=returnLivePreviewText(couponFormatOptions[index]);else for(var index=0;index<formatOptions.length;index++)formatOptions[index].text=formatOptions[index].text.replace(/-/g,"")},checkHyphenDelimiterSetting=function(){return $("input[id='affwp_settings[coupon_hyphen_delimiter]']").is(":checked")},resetCFSelectedOption=function(){var formatValue=$("select[id='affwp_settings[coupon_format]'] option:selected")[0].value;!1===checkHyphenDelimiterSetting()&&(formatValue=formatValue.replace(/-/g,"")),$("select[id='affwp_settings[coupon_format]'] option:selected")[0].text=formatValue};for(var formatOptions=document.getElementById("affwp_settings[coupon_format]").options,couponFormatOptions=[],option=0;option<formatOptions.length;option++)couponFormatOptions.push(formatOptions[option].text),formatOptions[option].text=returnLivePreviewText(couponFormatOptions[option]);resetCFSelectedOption(),$("select[id='affwp_settings[coupon_format]']").on("change",function(event){updateCouponFormatOptions(),resetCFSelectedOption()}),$("input[id='affwp_settings[coupon_hyphen_delimiter]']").on("click",function(event){updateCouponFormatOptions(),resetCFSelectedOption()}),$("input[id='affwp_settings[coupon_custom_text]']").on("keyup",function(){for(var i=0;i<formatOptions.length;i++)formatOptions[i].text=returnLivePreviewText(couponFormatOptions[i])})}$(".affwp-promo-notice").each(function(){const notice=$(this),noticeId=notice.data("id"),nonce=notice.data("nonce"),lifespan=notice.data("lifespan");notice.on("click",".notice-dismiss, .affwp-notice-dismiss",function(event){wp.ajax.send("affwp_dismiss_promo",{data:{notice_id:noticeId,nonce:nonce,lifespan:lifespan},success:function(){notice.slideUp("fast");const uid=userSettings.uid?userSettings.uid:0,seenKey="affwp-notice-"+noticeId+"-seen-"+uid;window.localStorage.removeItem(seenKey)}})})});const topOfPageNotice=jQuery(".affwp-admin-notice-top-of-page");if(topOfPageNotice.length>0){const topOfPageNoticeEl=topOfPageNotice.detach();jQuery("#wpbody-content").prepend(topOfPageNoticeEl);const uid=userSettings.uid?userSettings.uid:0,noticeId=topOfPageNoticeEl.data("id"),seenKey="affwp-notice-"+noticeId+"-seen-"+uid;window.localStorage.getItem(seenKey)?topOfPageNoticeEl.show():setTimeout(function(){window.localStorage.setItem(seenKey,!0),topOfPageNotice.slideDown()},1500)}if($.inArray(pagenow,["affiliates_page_affiliate-wp-affiliates","affiliates_page_affiliate-wp-settings"])>-1){var flatRateBasisField,referralRateTypeField;"affiliates_page_affiliate-wp-settings"===pagenow?(flatRateBasisField=$(".affwp-referral-rate-type-field"),referralRateTypeField=$('input[name="affwp_settings[referral_rate_type]"]')):(flatRateBasisField=$("#flat_rate_basis").closest("tr"),referralRateTypeField=$("#rate_type")),referralRateTypeField.on("change",function(e){"flat"!==e.target.value?flatRateBasisField.hide():flatRateBasisField.show()})}"undefined"!=typeof postboxes&&/affiliate-wp/.test(pagenow)&&postboxes.add_postbox_toggles(pagenow)});